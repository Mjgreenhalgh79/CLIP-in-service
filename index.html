<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central Line Train Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f9;
            margin: 20px;
        }
        h1 {
            color: #d32f2f;
        }
        h2 {
            color: #444;
        }
        #lastUpdated {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        .container {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        table {
            width: 400px;
            border-collapse: collapse;
            background: white;
            margin-bottom: 20px;
        }
        th, td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #d32f2f;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>ðŸš† Central Line Train Tracker</h1>
    <p id="lastUpdated">Last updated: Loading...</p>

    <div class="container">
        <div>
            <h2>Eastbound Trains</h2>
            <table>
                <thead>
                    <tr>
                        <th>Station</th>
                        <th>Train LCID</th>
                    </tr>
                </thead>
                <tbody id="eastboundTable">
                    <tr><td colspan="2">Loading...</td></tr>
                </tbody>
            </table>
        </div>
        <div>
            <h2>Westbound Trains</h2>
            <table>
                <thead>
                    <tr>
                        <th>Station</th>
                        <th>Train LCID</th>
                    </tr>
                </thead>
                <tbody id="westboundTable">
                    <tr><td colspan="2">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const eastboundStations = [
            "West Ruislip", "Ruislip Gardens", "South Ruislip", "Northolt", "Greenford", "Perivale", "Hanger Lane",
            "North Acton", "West Acton", "East Acton", "White City", "Shepherd's Bush", "Holland Park", "Notting Hill Gate",
            "Queensway", "Lancaster Gate", "Marble Arch", "Bond Street", "Oxford Circus", "Tottenham Court Road", "Holborn",
            "Chancery Lane", "St. Paul's", "Bank", "Liverpool Street", "Bethnal Green", "Mile End", "Stratford", "Leyton",
            "Leytonstone", "Wanstead", "Redbridge", "Gants Hill", "Newbury Park", "Barkingside", "Fairlop", "Hainault",
            "Snaresbrook", "South Woodford", "Woodford", "Buckhurst Hill", "Loughton", "Debden", "Theydon Bois", "Epping"
        ];

        const westboundStations = [...eastboundStations].reverse(); 

        async function fetchTrainData() {
            try {
                const response = await fetch("https://api.tfl.gov.uk/Line/central/Arrivals");
                const data = await response.json();
                
                // Debugging log to check if data is fetched
                console.log(data);

                document.getElementById("eastboundTable").innerHTML = "";
                document.getElementById("westboundTable").innerHTML = "";

                const eastboundTrains = {};
                const westboundTrains = {};

                data.forEach(train => {
                    const station = train.stationName;
                    const lcid = train.vehicleId;
                    const direction = train.direction.toLowerCase(); // "inbound" (westbound) or "outbound" (eastbound)

                    if (eastboundStations.includes(station) && direction === "outbound") {
                        eastboundTrains[station] = lcid;
                    } else if (westboundStations.includes(station) && direction === "inbound") {
                        westboundTrains[station] = lcid;
                    }
                });

                eastboundStations.forEach(station => {
                    let row = `<tr>
                        <td>${station}</td>
                        <td>${eastboundTrains[station] || "â€”"}</td>
                    </tr>`;
                    document.getElementById("eastboundTable").innerHTML += row;
                });

                westboundStations.forEach(station => {
                    let row = `<tr>
                        <td>${station}</td>
                        <td>${westboundTrains[station] || "â€”"}</td>
                    </tr>`;
                    document.getElementById("westboundTable").innerHTML += row;
                });

                const now = new Date();
                document.getElementById("lastUpdated").textContent = 
                    "Last updated: " + now.toLocaleTimeString();

            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById("lastUpdated").textContent = "Error fetching data.";
                document.getElementById("eastboundTable").innerHTML = "<tr><td colspan='2'>Error loading data.</td></tr>";
                document.getElementById("westboundTable").innerHTML = "<tr><td colspan='2'>Error loading data.</td></tr>";
            }
        }

        fetchTrainData();
        setInterval(fetchTrainData, 30000);  // ðŸ”„ Refresh every 30 seconds
    </script>
</body>
</html>
